---
import type { CollectionEntry } from "astro:content";
import BookmarkIcon from "../icons/Bookmark.astro";
import Share2Icon from "../icons/Share2.astro";
import type { Lang } from "../utils/i18n";
import {
  getLocalizedUrl,
  getLangFromUrl,
  useTranslations,
} from "../utils/i18n";

interface Props {
  gag: CollectionEntry<"gags">;
  lang?: Lang;
}

// If lang prop is not provided, detect from URL
const detectedLang = getLangFromUrl(Astro.url);
const { gag, lang = detectedLang } = Astro.props;
const t = useTranslations(lang);
---

<div
  class="card bg-card border-border hover-lift group rounded-lg border"
  data-gag-slug={gag.data.slug}
>
  <div class="p-6">
    <div class="mb-4 flex items-start justify-between">
      <div class="flex flex-wrap gap-2">
        {
          gag.data.tags.map((tag: string) => (
            <a
              href={getLocalizedUrl(`/tags/${tag}`, lang)}
              class="bg-primary/10 text-primary hover:bg-primary/20 inline-block rounded-full px-3 py-1 text-sm font-medium transition-colors"
            >
              #{tag}
            </a>
          ))
        }
      </div>
      <div class="flex items-center space-x-2">
        <button
          class="save-btn hover:bg-accent rounded-md p-2 transition-colors"
          data-gag={JSON.stringify({
            slug: gag.data.slug,
            title: gag.data.title,
            description: gag.data.description,
            tags: gag.data.tags,
          })}
          aria-label={t("저장", "Save")}
        >
          <BookmarkIcon class="bookmark-icon h-4 w-4" />
          <BookmarkIcon
            class="bookmark-check-icon text-primary hidden h-4 w-4"
            fill="currentColor"
          />
        </button>
        <button
          class="share-btn hover:bg-accent rounded-md p-2 transition-colors"
          data-content={`${gag.data.title}${gag.data.description ? " - " + gag.data.description : ""}`}
          data-slug={gag.data.slug}
          aria-label={t("공유", "Share")}
        >
          <Share2Icon size={16} />
        </button>
      </div>
    </div>

    <div class="mb-4">
      <a href={getLocalizedUrl(`/gags/${gag.data.slug}`, lang)}>
        <h2
          class="text-foreground hover:text-primary mb-2 cursor-pointer text-lg font-bold transition-colors"
        >
          {gag.data.title}
        </h2>
      </a>
    </div>
  </div>
</div>

<style>
  .hover-lift {
    transition:
      transform 0.2s ease-in-out,
      box-shadow 0.2s ease-in-out;
  }
  .hover-lift:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  }
</style>

<script>
  import { initGagInteractions } from "../scripts/gagInteractions";

  // 페이지 로드 시 초기화
  initGagInteractions();
</script>
