---
import type { CollectionEntry } from "astro:content";
import BookmarkIcon from "../icons/Bookmark.astro";
import Share2Icon from "../icons/Share2.astro";
import type { Lang } from "../utils/i18n";
import { getLocalizedUrl, useTranslations } from "../utils/i18n";

interface Props {
  gag: CollectionEntry<"gags">;
  lang?: Lang;
}

const { gag, lang = "ko" } = Astro.props;
const t = useTranslations(lang);
---

<div
  class="card bg-card border-border rounded-lg border"
  data-gag-slug={gag.data.slug}
>
  <div class="p-6 md:p-8">
    <div class="mb-4 flex items-start justify-between">
      <div class="flex flex-wrap gap-2">
        {
          gag.data.tags.map((tag: string) => (
            <a
              href={getLocalizedUrl(`/tags/${tag}`, lang)}
              class="bg-primary/10 text-primary hover:bg-primary/20 inline-block rounded-full px-3 py-1 text-sm font-medium transition-colors"
            >
              #{tag}
            </a>
          ))
        }
      </div>
      <div class="flex items-center gap-2">
        <button
          class="save-btn hover:bg-accent rounded-md p-2 transition-colors"
          data-gag={JSON.stringify({
            slug: gag.data.slug,
            title: gag.data.title,
            description: gag.data.description,
            tags: gag.data.tags,
          })}
          aria-label={t("저장", "Save")}
        >
          <BookmarkIcon class="bookmark-icon h-4 w-4" />
          <BookmarkIcon
            class="bookmark-check-icon text-primary hidden h-4 w-4"
            fill="currentColor"
          />
        </button>
        <button
          class="share-btn hover:bg-accent rounded-md p-2 transition-colors"
          data-content={`${gag.data.title}${gag.data.description ? " - " + gag.data.description : ""}`}
          data-slug={gag.data.slug}
          aria-label={t("공유", "Share")}
        >
          <Share2Icon size={16} />
        </button>
      </div>
    </div>

    <div class="mb-4">
      <h1 class="text-foreground mb-4 text-2xl font-bold md:text-3xl">
        {t("Q.", "Q.")}
        {gag.data.title}
      </h1>

      {
        gag.data.description && (
          <p class="text-foreground text-lg md:text-xl">
            {t("A.", "A.")} {gag.data.description}
          </p>
        )
      }
    </div>

    {
      gag.data.createdAt && (
        <div class="text-muted-foreground text-sm">
          {new Date(gag.data.createdAt).toLocaleDateString(
            lang === "ko" ? "ko-KR" : "en-US",
            {
              year: "numeric",
              month: "long",
              day: "numeric",
            },
          )}
        </div>
      )
    }
  </div>
</div>

<script>
  import { initGagInteractions } from "../scripts/gagInteractions";

  // 페이지 로드 시 초기화
  initGagInteractions();
</script>
