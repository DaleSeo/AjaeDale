---
import { type CollectionEntry } from "astro:content";
import BookmarkIcon from "../icons/Bookmark.astro";
import Share2Icon from "../icons/Share2.astro";
import { getLocalizedUrl, type Lang, useTranslations } from "../utils/i18n";

interface Props {
  gag: CollectionEntry<"gags">;
  lang: Lang;
}

const { gag, lang } = Astro.props;
const t = useTranslations(lang);
---

<article class="from-primary/5 to-background bg-gradient-to-b px-4 py-16">
  <div class="container mx-auto max-w-3xl">
    <header class="mb-8 text-center">
      <h2 class="text-foreground mb-2 text-3xl font-bold">
        🤣 {t("오늘의 아재개그", "Pun of the Day")}
      </h2>
      <p class="text-muted-foreground">
        {
          t(
            "매일 바뀌는 특별한 개그를 만나보세요",
            "Discover a special pun that changes daily",
          )
        }
      </p>
    </header>

    <div
      class="from-primary/10 via-background to-primary/5 border-primary/20 rounded-2xl border-2 bg-gradient-to-br p-8 shadow-lg transition-all duration-300 hover:shadow-xl md:p-12"
    >
      <div class="mb-6 flex items-start justify-between">
        {
          gag.data.tags.length > 0 && (
            <div class="flex flex-wrap gap-2">
              {gag.data.tags.map((tag: string) => (
                <span class="bg-primary/10 text-foreground inline-block rounded-full px-4 py-2 text-sm font-medium">
                  #{tag}
                </span>
              ))}
            </div>
          )
        }
        <div class="flex items-center space-x-2">
          <button
            class="save-btn hover:bg-background/50 rounded-lg p-3 transition-colors"
            data-gag={JSON.stringify({
              slug: gag.data.slug,
              title: gag.data.title,
              description: gag.data.description,
            })}
            aria-label={t("저장", "Save")}
          >
            <BookmarkIcon class="bookmark-icon h-6 w-6" />
            <BookmarkIcon
              class="bookmark-check-icon text-primary hidden h-6 w-6"
              fill="currentColor"
            />
          </button>
          <button
            class="share-btn hover:bg-background/50 rounded-lg p-3 transition-colors"
            data-content={`${gag.data.title}${gag.data.description ? " - " + gag.data.description : ""}`}
            data-slug={gag.data.slug}
            aria-label={t("공유", "Share")}
          >
            <Share2Icon size={24} />
          </button>
        </div>
      </div>

      <div class="mb-6 text-center">
        <h3 class="text-foreground mb-3 text-xl font-bold md:text-2xl">
          {t("Q.", "Q.")}
          {gag.data.title}
        </h3>
        {
          gag.data.description && (
            <p class="text-foreground text-lg md:text-xl">
              {t("A.", "A.")} {gag.data.description}
            </p>
          )
        }
      </div>

      <footer class="mt-6 text-center">
        <a
          href={getLocalizedUrl(`/gags/${gag.data.slug}`, lang)}
          class="bg-primary text-primary-foreground hover:bg-primary/90 inline-flex items-center rounded-lg px-6 py-3 font-medium transition-colors"
        >
          {t("자세히 보기", "View More")}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="ml-2"
          >
            <path d="M5 12h14"></path>
            <path d="m12 5 7 7-7 7"></path>
          </svg>
        </a>
      </footer>
    </div>
  </div>
</article>

<script>
  import { initGagInteractions } from "../scripts/gagInteractions";

  // 페이지 로드 시 초기화
  initGagInteractions();
</script>
