---
import { type CollectionEntry } from "astro:content";
import BookmarkIcon from "../icons/Bookmark.astro";
import Share2Icon from "../icons/Share2.astro";
import { getLocalizedUrl, type Lang } from "../utils/i18n";

interface Props {
  gag: CollectionEntry<"gags">;
  lang: Lang;
}

const { gag, lang } = Astro.props;

const messages = {
  "today.title": { ko: "오늘의 개그", en: "Today's Pun" },
  "today.subtitle": {
    ko: "매일 바뀌는 특별한 개그를 만나보세요",
    en: "Discover a special pun that changes daily",
  },
  "today.badge": { ko: "TODAY", en: "TODAY" },
  "today.viewMore": { ko: "자세히 보기", en: "View More" },
  "gag.question": { ko: "Q.", en: "Q." },
  "gag.answer": { ko: "A.", en: "A." },
  "gag.save": { ko: "저장", en: "Save" },
  "gag.share": { ko: "공유", en: "Share" },
};

const t = (key: string) =>
  (messages as Record<string, Record<string, string>>)[key]?.[lang] ||
  (messages as Record<string, Record<string, string>>)[key]?.ko ||
  "";
---

<section class="from-primary/5 to-background bg-gradient-to-b px-4 py-16">
  <div class="container mx-auto max-w-4xl">
    <div class="mb-8 text-center">
      <h2 class="text-foreground mb-2 text-3xl font-bold">
        ✨ {t("today.title")}
      </h2>
      <p class="text-muted-foreground">
        {t("today.subtitle")}
      </p>
    </div>

    <div
      class="from-primary/10 via-background to-primary/5 border-primary/20 rounded-2xl border-2 bg-gradient-to-br p-8 shadow-lg transition-all duration-300 hover:shadow-xl md:p-12"
    >
      <div class="mb-6 flex items-start justify-between">
        <div class="flex items-center gap-3">
          {
            gag.data.tags.length > 0 && (
              <span class="bg-primary text-primary-foreground inline-block rounded-full px-4 py-2 text-sm font-bold shadow-md">
                #{gag.data.tags[0]}
              </span>
            )
          }
          <span
            class="inline-block animate-pulse rounded-full bg-yellow-400 px-3 py-1 text-xs font-bold text-yellow-900"
          >
            {t("today.badge")}
          </span>
        </div>
        <div class="flex items-center space-x-2">
          <button
            class="save-btn hover:bg-background/50 rounded-lg p-3 transition-colors"
            data-gag={JSON.stringify({
              slug: gag.data.slug,
              title: gag.data.title,
              description: gag.data.description,
            })}
            aria-label={t("gag.save")}
          >
            <BookmarkIcon class="bookmark-icon h-6 w-6" />
            <BookmarkIcon
              class="bookmark-check-icon text-primary hidden h-6 w-6"
              fill="currentColor"
            />
          </button>
          <button
            class="share-btn hover:bg-background/50 rounded-lg p-3 transition-colors"
            data-content={`${gag.data.title}${gag.data.description ? " - " + gag.data.description : ""}`}
            data-slug={gag.data.slug}
            aria-label={t("gag.share")}
          >
            <Share2Icon size={24} />
          </button>
        </div>
      </div>

      <div class="mb-6 text-center">
        <h3 class="text-foreground mb-3 text-xl font-bold md:text-2xl">
          {t("gag.question")}
          {gag.data.title}
        </h3>
        {
          gag.data.description && (
            <p class="text-foreground text-lg md:text-xl">
              {t("gag.answer")} {gag.data.description}
            </p>
          )
        }
      </div>

      <div class="mt-6 text-center">
        <a
          href={getLocalizedUrl(`/gags/${gag.data.slug}`, lang)}
          class="bg-primary text-primary-foreground hover:bg-primary/90 inline-flex items-center rounded-lg px-6 py-3 font-medium transition-colors"
        >
          {t("today.viewMore")}
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="ml-2"
          >
            <path d="M5 12h14"></path>
            <path d="m12 5 7 7-7 7"></path>
          </svg>
        </a>
      </div>
    </div>
  </div>
</section>
