---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../layouts/Layout.astro";
import GagCard from "../components/GagCard.astro";

type GagEntry = CollectionEntry<"gags">;

const allGags = await getCollection("gags", ({ data }: GagEntry) => {
  return data.published === true;
});

// ëœë¤ ê°œê·¸ ì„ íƒ
function getRandomGag(gags: GagEntry[]): GagEntry {
  const randomIndex = Math.floor(Math.random() * gags.length);
  return gags[randomIndex];
}

const randomGag = getRandomGag(allGags);
---

<Layout
  title="ëœë¤ ê°œê·¸"
  description="ëœë¤ìœ¼ë¡œ ì„ íƒëœ ì•„ì¬ê°œê·¸ë¥¼ ì¦ê²¨ë³´ì„¸ìš”"
  currentPage="random"
>
  <!-- í—¤ë” ì„¹ì…˜ -->
  <section class="py-12 px-4 bg-gradient-to-b from-primary/5 to-background">
    <div class="container mx-auto text-center max-w-4xl">
      <h2 class="text-3xl md:text-4xl font-bold text-foreground mb-3">
        ğŸ² ëœë¤ ê°œê·¸
      </h2>
      <p class="text-lg text-muted-foreground">
        ë§¤ë²ˆ ìƒˆë¡œìš´ ê°œê·¸ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”!
      </p>
    </div>
  </section>

  <!-- ëœë¤ ê°œê·¸ ì„¹ì…˜ -->
  <section class="py-8 px-4">
    <div class="container mx-auto max-w-4xl">
      <GagCard
        gag={randomGag}
        variant="featured"
        titleLevel="h3"
        spoilerId="random-gag"
        showTitleLink={true}
      />
    </div>
  </section>

  <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
  <div class="py-8 px-4 text-center">
    <button
      type="button"
      class="text-lg font-medium px-8 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors shadow-md hover:shadow-lg"
      onclick="window.location.reload()"
    >
      ğŸ² ë‹¤ë¥¸ ê°œê·¸ ë³´ê¸°
    </button>
  </div>
</Layout>
