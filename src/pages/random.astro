---
import { getCollection, type CollectionEntry } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import AnswerSpoiler from "../components/AnswerSpoiler.astro";
import { tagToSlug } from "../utils/tagUtils";

type GagEntry = CollectionEntry<"gags">;

const allGags = await getCollection("gags", ({ data }: GagEntry) => {
  return data.published === true;
});

// ëœë¤ ê°œê·¸ ì„ íƒ
function getRandomGag(gags: GagEntry[]): GagEntry {
  const randomIndex = Math.floor(Math.random() * gags.length);
  return gags[randomIndex];
}

const randomGag = getRandomGag(allGags);
---

<BaseLayout
  title="ëœë¤ ê°œê·¸"
  description="ëœë¤ìœ¼ë¡œ ì„ íƒëœ ì•„ì¬ê°œê·¸ë¥¼ ì¦ê²¨ë³´ì„¸ìš”"
  currentPage="random"
>
  <div class="section-header" data-pagefind-ignore>
    <h2 class="section-title">ğŸ² ëœë¤ ê°œê·¸</h2>
    <p class="section-description">ë§¤ë²ˆ ìƒˆë¡œìš´ ê°œê·¸ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”!</p>
  </div>

  <!-- ëœë¤ ê°œê·¸ ì„¹ì…˜ -->
  <section class="page-section" data-pagefind-body>
    <article class="gag-card featured">
      <h3 class="gag-title">{randomGag.data.title}</h3>

      {
        randomGag.data.body && (
          <AnswerSpoiler answer={randomGag.data.body} id="random-gag" />
        )
      }

      <div class="gag-footer">
        <div class="tags">
          {
            randomGag.data.tags.map((tag: string) => (
              <a href={`/tags/${tagToSlug(tag)}`} class="tag">
                #{tag}
              </a>
            ))
          }
        </div>
        <a href={`/gags/${randomGag.data.slug}`} class="detail-link"
          >ìì„¸íˆ ë³´ê¸° â†’</a
        >
      </div>
    </article>
  </section>

  <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
  <div class="action-buttons" data-pagefind-ignore>
    <button
      type="button"
      class="action-button random"
      onclick="window.location.reload()"
    >
      ğŸ² ë‹¤ë¥¸ ê°œê·¸ ë³´ê¸°
    </button>
  </div>
</BaseLayout>
