---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import DetailCard from "../../components/DetailCard.astro";
import Heading from "../../components/Heading.astro";
import {
  getStaticPathsLocales,
  normalizeLang,
  useTranslations,
} from "../../utils/i18n";

export async function getStaticPaths() {
  return getStaticPathsLocales().map((lang) => ({
    params: { lang },
  }));
}

type GagEntry = CollectionEntry<"gags">;

const { lang: langParam } = Astro.params;
const lang = normalizeLang(langParam);

const allGags = await getCollection("gags", ({ data }: GagEntry) => {
  return data.published === true;
});

// ì˜¤ëŠ˜ì˜ ê°œê·¸ ì„ íƒ (ë‚ ì§œ ê¸°ë°˜ìœ¼ë¡œ ì¼ê´€ëœ ì„ íƒ)
function getTodaysGag(gags: GagEntry[]): GagEntry {
  const today = new Date();
  const dayOfYear = Math.floor(
    (today.getTime() - new Date(today.getFullYear(), 0, 0).getTime()) /
      (1000 * 60 * 60 * 24),
  );
  const index = dayOfYear % gags.length;
  return gags[index];
}

// ëœë¤ ê°œê·¸ ì„ íƒ
function getRandomGag(gags: GagEntry[]): GagEntry {
  const randomIndex = Math.floor(Math.random() * gags.length);
  return gags[randomIndex];
}

const todaysGag = getTodaysGag(allGags);
const randomGag = getRandomGag(allGags);

const t = useTranslations(lang);
---

<Layout title={t("í™ˆ", "Home")} currentPage="home" lang={lang}>
  <!-- ìˆ¨ê²¨ì§„ ë©”ì¸ ì œëª© (SEO ë° ì ‘ê·¼ì„±ì„ ìœ„í•¨) -->
  <h1 class="sr-only">
    {
      t(
        "ì•„ì¬ë‹¬ë ˆ - í•œêµ­ ì•„ì €ì”¨ë“¤ì´ ì‚¬ë‘í•˜ëŠ” ê°œê·¸ ì´ì •ë¦¬! ì•„ì¬ê°œê·¸ ì›ƒì–´ë‹¬ë ˆ ğŸ¤£",
        "AjaeDale - The ultimate collection of Korean dad jokes! Laugh with us ğŸ¤£",
      )
    }
  </h1>

  <!-- ì˜¤ëŠ˜ì˜ ê°œê·¸ & ëœë¤ ê°œê·¸ ì„¹ì…˜ -->
  <section
    class="from-primary/5 to-background bg-gradient-to-b px-4 pt-12 pb-16"
  >
    <div class="container mx-auto max-w-6xl">
      <div class="grid grid-cols-1 gap-8">
        <div class="mx-auto w-full max-w-2xl">
          <Heading
            as="h2"
            title={`ğŸ¤£ ${t("ì˜¤ëŠ˜ì˜ ê°œê·¸", "Pun of the Day")}`}
            subtitle={t(
              "ë§¤ì¼ ë¨¹ëŠ” ì›ƒìŒ ì˜ì–‘ì œ, í•˜ë£¨ ì¢…ì¼ ìœ ì¾Œí•œ ê¸°ë¶„!",
              "Take your daily dose of humor for all-day joy!",
            )}
          />
          <DetailCard gag={todaysGag} lang={lang} featured />
        </div>

        <div class="mx-auto mt-12 mb-16 w-full max-w-2xl">
          <Heading
            as="h2"
            title={`ğŸ´ ${t("ìš´ëª…ì˜ ê°œê·¸", "Destined Pun")}`}
            subtitle={t(
              "ìš´ëª…ì´ ì„ íƒí•œ ê°œê·¸ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”!",
              "Meet your destined pun!",
            )}
          />
          <DetailCard gag={randomGag} lang={lang} featured />
        </div>
      </div>
    </div>
  </section>
</Layout>

<script>
  import { initGagInteractions } from "../../scripts/gagInteractions";

  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
  initGagInteractions();
</script>
