---
import Layout from "../../layouts/Layout.astro";
import {
  getStaticPathsLocales,
  normalizeLang,
  useTranslations,
} from "../../utils/i18n";

export async function getStaticPaths() {
  return getStaticPathsLocales().map((lang) => ({
    params: { lang },
  }));
}

const { lang: langParam } = Astro.params;
const lang = normalizeLang(langParam);

const t = useTranslations(lang);

const title = t("개그 API", "Pun API");
const description = t(
  "아재달레 개그 데이터를 자유롭게 사용하세요",
  "Use AjaeDale pun data freely",
);
const baseUrl = "https://www.ajaedale.com";
---

<Layout title={title} description={description} currentPage="api">
  <section class="px-4 py-16">
    <div class="container mx-auto max-w-4xl">
      <!-- 페이지 헤더 -->
      <div class="mb-12 text-center">
        <h1 class="text-foreground mb-4 text-3xl font-bold">🚀 {title}</h1>
        <p class="text-muted-foreground text-lg">
          {description}
        </p>
      </div>

      <!-- API 개요 -->
      <div class="bg-muted/50 mb-8 rounded-lg p-6">
        <h2 class="text-foreground mb-4 text-2xl font-semibold">
          {t("개요", "Overview")}
        </h2>
        <p class="text-muted-foreground mb-4">
          {
            t(
              "아재달레는 무료 REST API를 제공합니다. 모든 엔드포인트는 읽기 전용이며, 빌드 시점에 정적 JSON 파일로 생성됩니다.",
              "AjaeDale provides a free REST API. All endpoints are read-only and generated as static JSON files at build time.",
            )
          }
        </p>
        <ul class="text-muted-foreground list-inside list-disc space-y-2">
          <li>
            {
              t(
                "✅ 완전 무료 - 인증 불필요",
                "✅ Completely Free - No authentication required",
              )
            }
          </li>
          <li>
            {
              t(
                "✅ CORS 지원 - 모든 도메인에서 접근 가능",
                "✅ CORS Enabled - Accessible from any domain",
              )
            }
          </li>
          <li>
            {
              t(
                "✅ 정적 파일 - 빠른 응답 속도",
                "✅ Static Files - Fast response times",
              )
            }
          </li>
          <li>
            {
              t(
                "✅ 읽기 전용 - GET 요청만 지원",
                "✅ Read-only - GET requests only",
              )
            }
          </li>
        </ul>
      </div>

      <!-- 개그 엔드포인트 -->
      <div class="mb-8">
        <h2 class="text-foreground mb-6 text-2xl font-semibold">
          {t("개그 엔드포인트", "Pun Endpoints")}
        </h2>

        <!-- 모든 개그 -->
        <div class="bg-card mb-6 rounded-lg border p-6">
          <div class="mb-4">
            <h3 class="text-foreground mb-2 text-xl font-medium">
              {t("모든 개그 조회", "Get All Puns")}
            </h3>
            <code
              class="bg-muted text-primary block rounded px-3 py-2 font-mono text-sm"
            >
              GET {baseUrl}/api/gags.json
            </code>
          </div>
          <p class="text-muted-foreground mb-4">
            {
              t(
                "게시된 모든 개그를 최신순으로 반환합니다.",
                "Returns all published puns sorted by creation date.",
              )
            }
          </p>
          <details class="mb-4">
            <summary
              class="text-primary cursor-pointer font-medium hover:underline"
            >
              {t("예시 응답 보기", "View Example Response")}
            </summary>
            <pre
              class="bg-muted mt-4 overflow-x-auto rounded p-4"><code class="text-sm">{JSON.stringify(
                [
                  {
                    slug: "king-falls-kingkong",
                    lang: "ko",
                    title: "왕이 넘어지면?",
                    description: "킹콩",
                    tags: ["왕"],
                    featured: false,
                    createdAt: "2025-09-23T00:17:31.623Z",
                  },
                ],
                null,
                2,
              )}</code></pre>
          </details>
        </div>

        <!-- 개별 개그 -->
        <div class="bg-card mb-6 rounded-lg border p-6">
          <div class="mb-4">
            <h3 class="text-foreground mb-2 text-xl font-medium">
              {t("특정 개그 조회", "Get Single Pun")}
            </h3>
            <code
              class="bg-muted text-primary block rounded px-3 py-2 font-mono text-sm"
            >
              GET {baseUrl}/api/gags/[slug].json
            </code>
          </div>
          <p class="text-muted-foreground mb-4">
            {
              t(
                "slug로 특정 개그의 상세 정보를 조회합니다.",
                "Get detailed information for a specific pun by slug.",
              )
            }
          </p>
        </div>

        <!-- 인기 개그 -->
        <div class="bg-card mb-6 rounded-lg border p-6">
          <div class="mb-4">
            <h3 class="text-foreground mb-2 text-xl font-medium">
              {t("인기 개그 조회", "Get Featured Puns")}
            </h3>
            <code
              class="bg-muted text-primary block rounded px-3 py-2 font-mono text-sm"
            >
              GET {baseUrl}/api/gags/featured.json
            </code>
          </div>
          <p class="text-muted-foreground">
            {
              t(
                "featured로 표시된 인기 개그만 반환합니다.",
                "Returns only puns marked as featured.",
              )
            }
          </p>
        </div>

        <!-- 최신 개그 -->
        <div class="bg-card mb-6 rounded-lg border p-6">
          <div class="mb-4">
            <h3 class="text-foreground mb-2 text-xl font-medium">
              {t("최신 개그 조회", "Get Latest Puns")}
            </h3>
            <code
              class="bg-muted text-primary block rounded px-3 py-2 font-mono text-sm"
            >
              GET {baseUrl}/api/gags/latest.json
            </code>
          </div>
          <p class="text-muted-foreground">
            {
              t(
                "최신 20개의 개그를 반환합니다.",
                "Returns the 20 most recent puns.",
              )
            }
          </p>
        </div>
      </div>

      <!-- 태그 엔드포인트 -->
      <div class="mb-8">
        <h2 class="text-foreground mb-6 text-2xl font-semibold">
          {t("태그 엔드포인트", "Tag Endpoints")}
        </h2>

        <!-- 모든 태그 -->
        <div class="bg-card mb-6 rounded-lg border p-6">
          <div class="mb-4">
            <h3 class="text-foreground mb-2 text-xl font-medium">
              {t("모든 태그 조회", "Get All Tags")}
            </h3>
            <code
              class="bg-muted text-primary block rounded px-3 py-2 font-mono text-sm"
            >
              GET {baseUrl}/api/tags.json
            </code>
          </div>
          <p class="text-muted-foreground mb-4">
            {
              t(
                "모든 태그와 각 태그의 개그 수를 반환합니다.",
                "Returns all tags with pun counts for each tag.",
              )
            }
          </p>
          <details class="mb-4">
            <summary
              class="text-primary cursor-pointer font-medium hover:underline"
            >
              {t("예시 응답 보기", "View Example Response")}
            </summary>
            <pre
              class="bg-muted mt-4 overflow-x-auto rounded p-4"><code class="text-sm">{JSON.stringify(
                [
                  {
                    name: "왕",
                    slug: "wang",
                    count: 5,
                  },
                ],
                null,
                2,
              )}</code></pre>
          </details>
        </div>

        <!-- 태그별 개그 -->
        <div class="bg-card mb-6 rounded-lg border p-6">
          <div class="mb-4">
            <h3 class="text-foreground mb-2 text-xl font-medium">
              {t("태그별 개그 조회", "Get Puns by Tag")}
            </h3>
            <code
              class="bg-muted text-primary block rounded px-3 py-2 font-mono text-sm"
            >
              GET {baseUrl}/api/tags/[slug].json
            </code>
          </div>
          <p class="text-muted-foreground">
            {
              t(
                "특정 태그가 포함된 모든 개그를 반환합니다.",
                "Returns all puns containing a specific tag.",
              )
            }
          </p>
        </div>
      </div>

      <!-- CORS -->
      <div class="bg-muted/50 mb-8 rounded-lg p-6">
        <h2 class="text-foreground mb-4 text-2xl font-semibold">
          {t("CORS", "CORS")}
        </h2>
        <p class="text-muted-foreground">
          {
            t(
              "모든 API 엔드포인트는 CORS가 활성화되어 있어 어떤 도메인에서든 접근할 수 있습니다.",
              "All API endpoints have CORS enabled and can be accessed from any domain.",
            )
          }
        </p>
      </div>

      <!-- 사용 예시 -->
      <div class="bg-card rounded-lg border p-6">
        <h2 class="text-foreground mb-4 text-2xl font-semibold">
          {t("사용 예시", "Usage Example")}
        </h2>
        <p class="text-muted-foreground mb-4">
          {
            t(
              "JavaScript에서 fetch API로 쉽게 사용할 수 있습니다:",
              "Easy to use with the fetch API in JavaScript:",
            )
          }
        </p>
        <pre
          class="bg-muted overflow-x-auto rounded p-4"><code class="text-sm">fetch('{baseUrl}/api/gags.json')
  .then(response => response.json())
  .then(data => console.log(data));</code></pre>
      </div>
    </div>
  </section>
</Layout>
