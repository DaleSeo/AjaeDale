---
import BaseLayout from "../layouts/BaseLayout.astro";
import PagefindSearch from "astro-pagefind/components/Search";

// URLì—ì„œ ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°
const searchParams = Astro.url.searchParams;
const query = searchParams.get("q") || "";
---

<BaseLayout
  title="ê²€ìƒ‰"
  description="ì•„ì¬ë‹¬ë ˆì—ì„œ ì›í•˜ëŠ” ê°œê·¸ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”"
  currentPage="search"
>
  <section class="search-page">
    <div class="search-header">
      <h2>ğŸ” ê°œê·¸ ê²€ìƒ‰</h2>
      <p>ì°¾ê³  ì‹¶ì€ ê°œê·¸ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”!</p>
    </div>

    <PagefindSearch
      id="search"
      className="pagefind-ui"
      query={query}
      uiOptions={{
        showImages: false,
        excerptLength: 0,
        translations: {
          clear_search: "âœ–ï¸",
        },
      }}
    />
  </section>
</BaseLayout>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    // ê²€ìƒ‰ ì…ë ¥ì°½ì´ ë¡œë“œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
    const checkForSearch = () => {
      const searchInput = document.querySelector(
        ".pagefind-ui__search-input",
      ) as HTMLInputElement;

      if (searchInput) {
        // URLì—ì„œ ê²€ìƒ‰ì–´ ë³µì›
        const urlParams = new URLSearchParams(window.location.search);
        const savedQuery = urlParams.get("q");
        if (savedQuery) {
          searchInput.value = savedQuery;
          searchInput.dispatchEvent(new Event("input"));
        }

        // ê²€ìƒ‰ì–´ ë³€ê²½ì‹œ URL ì—…ë°ì´íŠ¸
        searchInput.addEventListener("input", (e) => {
          const query = (e.target as HTMLInputElement).value;
          const url = new URL(window.location.href);
          if (query) {
            url.searchParams.set("q", query);
          } else {
            url.searchParams.delete("q");
          }
          window.history.replaceState({}, "", url.toString());
        });
      } else {
        // ì•„ì§ ë¡œë“œ ì•ˆëìœ¼ë©´ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„
        setTimeout(checkForSearch, 100);
      }
    };

    checkForSearch();
  });
</script>

<style>
  .search-page {
    max-width: 800px;
    margin: 0 auto;
  }

  .search-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .search-header h2 {
    color: var(--color-primary);
    font-size: 2.5rem;
    margin-bottom: 1rem;
  }

  .search-header p {
    color: var(--color-text-muted);
    font-size: 1.25rem;
  }

  #search {
    min-height: 400px;
  }

  /* ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ë³¸ë¬¸ ìˆ¨ê¹€ (ì§ˆë¬¸ë§Œ í‘œì‹œ) */
  :global(.pagefind-ui__result-excerpt) {
    display: none !important;
  }

  /* ê²€ìƒ‰ ê²°ê³¼ ë‚´ë¶€ ë§ˆì§„ ì œê±° */
  :global(.pagefind-ui__result-inner) {
    margin-top: 0 !important;
  }

  /* ê²€ìƒ‰ ê²°ê³¼ ìŠ¤íƒ€ì¼ë§ */
  :global(.pagefind-ui__result) {
    border-radius: 12px !important;
    padding: 1.5rem !important;
    margin-bottom: 0.5rem !important;
    background: var(--color-card) !important;
    border: 1px solid var(--color-border) !important;
  }

  :global(.pagefind-ui__result:hover) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  :global(.pagefind-ui__result-title) {
    color: var(--color-primary) !important;
    font-size: 1.25rem !important;
    font-weight: 600 !important;
  }

  @media (max-width: 768px) {
    .search-header h2 {
      font-size: 2rem;
    }

    .search-header p {
      font-size: 1.125rem;
    }

    :global(.pagefind-ui__result) {
      padding: 1.25rem !important;
    }
  }
</style>
