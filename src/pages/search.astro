---
// PagefindëŠ” ë¹Œë“œ íƒ€ì„ì— HTMLì„ íŒŒì‹±í•˜ë¯€ë¡œ ì„œë²„ ì‚¬ì´ë“œ ë°ì´í„° ì²˜ë¦¬ ë¶ˆí•„ìš”
---

<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê²€ìƒ‰ - ì•„ì¬ë‹¬ë ˆ</title>
    <meta
      name="description"
      content="ì•„ì¬ë‹¬ë ˆì—ì„œ ì›í•˜ëŠ” ê°œê·¸ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”"
    />
  </head>
  <body>
    <header>
      <h1>ğŸ” ê²€ìƒ‰</h1>
      <nav>
        <a href="/">í™ˆìœ¼ë¡œ</a>
      </nav>
    </header>

    <main>
      <!-- ê²€ìƒ‰ ì»¨íŠ¸ë¡¤ ì˜ì—­ -->
      <section class="search-controls">
        <div class="search-input-container">
          <input
            type="text"
            id="searchInput"
            placeholder="ê°œê·¸ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”..."
            class="search-input"
          />
          <button type="button" class="search-clear" id="clearButton">
            âœ•
          </button>
        </div>
      </section>

      <!-- ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ -->
      <section class="search-results">
        <div class="results-header">
          <p id="resultsCount">49ê°œì˜ ê°œê·¸</p>
        </div>

        <div class="gags-grid" id="resultsContainer">
          <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>

        <!-- ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ -->
        <div class="no-results" id="noResults" style="display: none;">
          <p>ğŸ˜… ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
          <p>ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ë‹¤ì‹œ ê²€ìƒ‰í•´ë³´ì„¸ìš”!</p>
        </div>
      </section>
    </main>

    <footer>
      <p>Made with â¤ï¸ for Everyone</p>
    </footer>

    <!-- Pagefind JavaScript API -->
    <script is:inline>
      // Pagefind ì´ˆê¸°í™” ë° ê²€ìƒ‰ ë¡œì§
      let pagefind;

      // URL íŒŒë¼ë¯¸í„° ê´€ë¦¬
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      function setQueryParam(param, value) {
        const url = new URL(window.location.href);
        if (value) {
          url.searchParams.set(param, value);
        } else {
          url.searchParams.delete(param);
        }
        window.history.replaceState({}, "", url);
      }

      async function initPagefind() {
        try {
          // Pagefind ìŠ¤í¬ë¦½íŠ¸ê°€ ì¡´ì¬í•˜ëŠ”ì§€ ë¨¼ì € í™•ì¸
          const response = await fetch("/pagefind/pagefind.js");
          if (!response.ok) {
            throw new Error("Pagefind script not found");
          }

          // Pagefind ëª¨ë“ˆ ë™ì  ë¡œë“œ
          pagefind = await import("/pagefind/pagefind.js");
          console.log("Pagefind loaded successfully");

          // ê²€ìƒ‰ ì…ë ¥ í™œì„±í™”
          document.getElementById("searchInput").placeholder =
            "ê°œê·¸ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”...";
          document.getElementById("searchInput").disabled = false;

          // URLì— ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ ë³µì›
          const savedQuery = getQueryParam("q");
          if (savedQuery) {
            searchInput.value = savedQuery;
            performSearch();
          }
        } catch (error) {
          console.error("Failed to load Pagefind:", error);
          // Fallback: ê²€ìƒ‰ ê¸°ëŠ¥ ë¹„í™œì„±í™” ì•Œë¦¼
          document.getElementById("searchInput").placeholder =
            "ê²€ìƒ‰ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‚¬ì´íŠ¸ë¥¼ ë¹Œë“œí•´ì£¼ì„¸ìš”.";
          document.getElementById("searchInput").disabled = true;

          // ì„ì‹œ ê²€ìƒ‰ ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ
          document.getElementById("resultsCount").textContent =
            "ê²€ìƒ‰ ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤";
          document.getElementById("noResults").style.display = "block";
          document.getElementById("noResults").innerHTML = `
            <p>ğŸ”§ ê²€ìƒ‰ ê¸°ëŠ¥ì´ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</p>
            <p>ì‚¬ì´íŠ¸ë¥¼ ë¹Œë“œí•œ í›„ì— ê²€ìƒ‰ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          `;
        }
      }

      // DOM ìš”ì†Œë“¤
      const searchInput = document.getElementById("searchInput");
      const clearButton = document.getElementById("clearButton");
      const resultsContainer = document.getElementById("resultsContainer");
      const resultsCount = document.getElementById("resultsCount");
      const noResults = document.getElementById("noResults");

      // ë””ë°”ìš´ìŠ¤ íƒ€ì´ë¨¸
      let searchTimeout;

      // ê²€ìƒ‰ í•¨ìˆ˜
      async function performSearch() {
        if (!pagefind) {
          await initPagefind();
          if (!pagefind) return;
        }

        const query = searchInput.value.trim();

        // URL íŒŒë¼ë¯¸í„° ì—…ë°ì´íŠ¸
        setQueryParam("q", query);

        if (!query) {
          renderNoResults(true);
          return;
        }

        try {
          // Pagefind ê²€ìƒ‰ ì‹¤í–‰
          const search = await pagefind.search(query);

          if (search.results.length === 0) {
            renderNoResults();
            return;
          }

          // ê²€ìƒ‰ ê²°ê³¼ ë°ì´í„° ë¡œë“œ
          const results = await Promise.all(
            search.results.map((result) => result.data()),
          );

          renderResults(results, query);
        } catch (error) {
          console.error("Search error:", error);
          renderNoResults();
        }
      }

      // ê²€ìƒ‰ ê²°ê³¼ ë Œë”ë§
      function renderResults(results, query) {
        resultsContainer.style.display = "flex";
        resultsContainer.style.flexDirection = "column";
        resultsContainer.style.gap = "0.5rem";
        noResults.style.display = "none";
        resultsCount.textContent = `"${query}"ì— ëŒ€í•œ ${results.length}ê°œì˜ ê²€ìƒ‰ ê²°ê³¼`;

        resultsContainer.innerHTML = results
          .map(
            (result) => `
          <div class="search-item">
            <a href="${result.url}">${result.meta.title || "ì œëª© ì—†ìŒ"}</a>
          </div>
        `,
          )
          .join("");
      }

      // ê²°ê³¼ ì—†ìŒ ë Œë”ë§
      function renderNoResults(isEmptyQuery = false) {
        resultsContainer.style.display = "none";

        if (isEmptyQuery || !searchInput.value.trim()) {
          // ê²€ìƒ‰ì–´ê°€ ì—†ëŠ” ê²½ìš° - ì´ˆê¸° ìƒíƒœ
          noResults.style.display = "none";
          resultsCount.textContent = "49ê°œì˜ ê°œê·¸";
          resultsContainer.style.display = "none";
        } else {
          // ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš°
          noResults.style.display = "block";
          resultsCount.textContent = "ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ";
        }
      }

      // ë””ë°”ìš´ìŠ¤ëœ ê²€ìƒ‰
      function debouncedSearch() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(performSearch, 300);
      }

      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
      searchInput.addEventListener("input", debouncedSearch);

      clearButton.addEventListener("click", () => {
        searchInput.value = "";
        setQueryParam("q", "");
        renderNoResults(true);
      });

      // í˜ì´ì§€ ë¡œë“œì‹œ Pagefind ì´ˆê¸°í™”
      document.addEventListener("DOMContentLoaded", initPagefind);
    </script>
  </body>
</html>

<style>
  :root {
    --color-primary: #2563eb;
    --color-primary-dark: #1e40af;
    --color-bg: #ffffff;
    --color-card: #f9fafb;
    --color-border: #e5e7eb;
    --color-text: #1f2937;
    --color-text-muted: #6b7280;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family:
      -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans KR", sans-serif;
    background-color: var(--color-bg);
    color: var(--color-text);
    line-height: 1.6;
  }

  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2rem 1rem;
    border-bottom: 1px solid var(--color-border);
  }

  header h1 {
    color: var(--color-primary);
    font-size: 2rem;
  }

  nav a {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 500;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    transition: background-color 0.2s;
  }

  nav a:hover {
    background-color: var(--color-card);
  }

  main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  /* ê²€ìƒ‰ ì»¨íŠ¸ë¡¤ ìŠ¤íƒ€ì¼ */
  .search-controls {
    margin-bottom: 2rem;
  }

  .search-input-container {
    position: relative;
    margin-bottom: 1rem;
  }

  .search-input {
    width: 100%;
    padding: 1rem 3rem 1rem 1rem;
    font-size: 1.1rem;
    border: 2px solid var(--color-border);
    border-radius: 12px;
    background: var(--color-card);
    transition: border-color 0.2s;
  }

  .search-input:focus {
    outline: none;
    border-color: var(--color-primary);
  }

  .search-clear {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    font-size: 1.2rem;
    color: var(--color-text-muted);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 4px;
    transition: background-color 0.2s;
  }

  .search-clear:hover {
    background-color: var(--color-border);
  }

  /* ê²€ìƒ‰ ê²°ê³¼ ìŠ¤íƒ€ì¼ */
  .results-header {
    margin-bottom: 1rem;
  }

  .results-header p {
    color: var(--color-text-muted);
    font-weight: 500;
  }

  .gags-grid {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .search-item {
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--color-border);
  }

  .search-item:last-child {
    border-bottom: none;
  }

  .search-item a {
    color: var(--color-primary);
    text-decoration: none;
    font-size: 1.125rem;
    font-weight: 500;
    transition: color 0.2s;
  }

  .search-item a:hover {
    color: var(--color-primary-dark);
    text-decoration: underline;
  }

  .no-results {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--color-text-muted);
  }

  .no-results p:first-child {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
  }

  footer {
    text-align: center;
    padding: 3rem 1rem;
    margin-top: 3rem;
    border-top: 1px solid var(--color-border);
    color: var(--color-text-muted);
  }

  @media (max-width: 768px) {
    .gags-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
