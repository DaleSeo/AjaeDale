---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import GagCard from "../components/GagCard.astro";

type GagEntry = CollectionEntry<"gags">;

export async function getStaticPaths() {
  const gags = await getCollection("gags", ({ data }: GagEntry) => {
    return data.published === true;
  });

  return gags.map((gag: GagEntry) => ({
    params: { slug: gag.data.slug },
    props: { gag },
  }));
}

interface Props {
  gag: GagEntry;
}

const { gag }: Props = Astro.props;
---

<BaseLayout title={gag.data.title} currentPage="gag">
  <article class="gag-detail-page">
    <GagCard
      gag={gag}
      variant="detail"
      titleLevel="h1"
      spoilerId={`detail-${gag.data.slug}`}
      showDate={true}
    />

    <!-- Giscus ëŒ“ê¸€/ì¢‹ì•„ìš” ì„¹ì…˜ -->
    <section class="giscus-section">
      <h2 class="giscus-title">ðŸ’¬ ëŒ“ê¸€ & ì¢‹ì•„ìš”</h2>
      <script
        src="https://giscus.app/client.js"
        data-repo="DaleSeo/AjaeDale"
        data-repo-id="R_kgDOPvdn0g"
        data-category="comments"
        data-category-id="DIC_kwDOPvdn0s4CvasI"
        data-mapping="og:title"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="1"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="ko"
        data-loading="lazy"
        crossorigin="anonymous"
        async
        is:inline></script>
    </section>
  </article>
</BaseLayout>

<style>
  .gag-detail-page {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1rem;
  }

  .giscus-section {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid #e5e7eb;
  }

  .giscus-title {
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #374151;
  }

  @media (max-width: 768px) {
    .gag-detail-page {
      padding: 1rem 0.5rem;
    }
  }
</style>
