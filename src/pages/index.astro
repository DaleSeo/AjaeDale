---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../layouts/Layout.astro";
import GagCard from "../components/GagCard.astro";

type GagEntry = CollectionEntry<"gags">;

const allGags = await getCollection("gags", ({ data }: GagEntry) => {
  return data.published === true;
});

// ì˜¤ëŠ˜ì˜ ê°œê·¸ ì„ íƒ (ë‚ ì§œ ê¸°ë°˜ìœ¼ë¡œ ì¼ê´€ëœ ì„ íƒ)
function getTodaysGag(gags: GagEntry[]): GagEntry {
  const today = new Date();
  const dayOfYear = Math.floor(
    (today.getTime() - new Date(today.getFullYear(), 0, 0).getTime()) /
      (1000 * 60 * 60 * 24),
  );
  const index = dayOfYear % gags.length;
  return gags[index];
}

const todaysGag = getTodaysGag(allGags);
const totalGagsCount = allGags.length;
---

<Layout title="í™ˆ" currentPage="home">
  <!-- ì˜¤ëŠ˜ì˜ ê°œê·¸ ì„¹ì…˜ -->
  <section class="todays-gag">
    <div class="section-header">
      <h2>ğŸŒŸ ì˜¤ëŠ˜ì˜ ê°œê·¸</h2>
      <p>
        {
          new Date().toLocaleDateString("ko-KR", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        }
      </p>
    </div>

    <GagCard
      gag={todaysGag}
      variant="featured"
      titleLevel="h3"
      spoilerId="todays-gag"
    />
  </section>

  <!-- ë” ë§ì€ ê°œê·¸ ë³´ê¸° -->
  <section class="stats-section">
    <p class="stats-text">
      ì´ <strong>{totalGagsCount}ê°œ</strong>ì˜ ê°œê·¸ê°€ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”!
    </p>

    <div class="action-buttons">
      <a href="/random" class="action-button random"> ğŸ² ëœë¤ ê°œê·¸ ë³´ê¸° </a>
      <a href="/search" class="action-button search"> ğŸ” ê°œê·¸ ê²€ìƒ‰í•˜ê¸° </a>
    </div>
  </section>
</Layout>

<style>
  /* Today's Gag Special Styling */
  .todays-gag {
    margin-bottom: var(--space-12);
  }

  .section-header {
    text-align: center;
    margin-bottom: var(--space-8);
  }

  .section-header h2 {
    color: var(--color-primary);
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    margin-bottom: var(--space-2);
    line-height: var(--line-height-tight);
  }

  .section-header p {
    color: var(--color-text-muted);
    font-size: var(--font-size-lg);
  }

  .featured-gag {
    max-width: 700px;
    margin: 0 auto;
  }

  .featured-gag .gag-title {
    text-align: center;
    margin-bottom: var(--space-4);
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .featured-gag {
      margin: 0 var(--space-4);
    }

    .section-header h2 {
      font-size: var(--font-size-3xl);
    }
  }
</style>
